CC=@CC@
AR=@AR@
RANLIB=@RANLIB@

BINDIR=@exedir@
MANDIR=@mandir@
LIBDIR=@libdir@
INCDIR=@prefix@/include

PGM=markdown
MKDLIB=libmarkdown.a
OBJS=mkdio.o markdown.o

all: $(PGM)

install: $(PGM)
	@INSTALL_PROGRAM@ $(PGM) $(BINDIR)
	@INSTALL_DATA@ $(MKDLIB) $(LIBDIR)
	@INSTALL_DATA@ mkdio.h $(INCDIR)

# install.man:
# 	@INSTALL_DIR@ $(MANDIR)/man3
# 	@INSTALL_DATA@ markdown.3 mkdio.3 $(MANDIR)/man3

version.o: VERSION
	echo 'char version[] = VERSION;' > version.c && \
	    $(CC) -DVERSION=\"`cat VERSION`\" -c version.c

$(PGM): main.c version.o $(MKDLIB)
	$(CC) -L. -I. -o $(PGM) main.c version.o -lmarkdown @LIBS@

$(MKDLIB): $(OBJS)
	$(AR) crv $(MKDLIB) $(OBJS)
	$(RANLIB) $(MKDLIB)

clean:
	rm -f $(PGM) *.o

distclean spotless: clean
	rm -f @GENERATED_FILES@ @CONFIGURE_FILES@


markdown.o: markdown.c config.h cstring.h
mkdio.o: mkdio.c mkdio.h cstring.h
$(PGM): mkdio.h config.h
